<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <script src="https://aframe.io/releases/1.4.1/aframe.min.js"></script>
        <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
        <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
    </head>
    <body style="margin: 0; overflow: hidden;">
        <a-scene
            vr-mode-ui="enabled: false"
            arjs="sourceType: webcam; videoTexture: true; debugUIEnabled: true;"
            renderer="antialias: true; alpha: true"
            embedded>
            <a-box
                color="red"
                scale="20 20 20"
                gps-entity-place="latitude: -6.761643; longitude: 39.193781;"
                look-at="[gps-camera]"
            ></a-box>
            <a-camera gps-camera rotation-reader></a-camera>
        </a-scene>
        <div id="debugDiv" style="position: fixed; top: 0; left: 0; background: rgba(0,0,0,0.5); color: white; padding: 10px; z-index: 9999;">
            Debug info will appear here
        </div>
        <script>
            // Handle deprecation warning
            if (THREE.PlaneBufferGeometry && !THREE.PlaneGeometry) {
                THREE.PlaneGeometry = THREE.PlaneBufferGeometry;
            }

            document.addEventListener('DOMContentLoaded', (event) => {
                console.log('DOM fully loaded and parsed');
                const debugDiv = document.getElementById('debugDiv');
                debugDiv.textContent = 'AR scene loaded. Looking for GPS signal...';
                const boxEl = document.querySelector('a-box');
                
                boxEl.addEventListener('gps-entity-place-added', () => {
                    debugDiv.textContent += '\nBox positioned based on GPS coordinates.';
                });

                window.addEventListener('gps-camera-update-position', e => {
                    try {
                        const latitude = e.detail.position.latitude;
                        const longitude = e.detail.position.longitude;
                        debugDiv.textContent = `Current GPS: lat ${latitude.toFixed(6)}, lon ${longitude.toFixed(6)}`;
                        
                        const distance = boxEl.getAttribute('distance');
                        if (distance !== null && distance !== undefined && !isNaN(distance)) {
                            debugDiv.textContent += `\nDistance to box: ${parseFloat(distance).toFixed(2)} meters`;
                        } else {
                            debugDiv.textContent += '\nDistance to box: Not available yet';
                        }
                    } catch (error) {
                        console.error('Error in GPS update:', error);
                        debugDiv.textContent += `\nError in GPS update: ${error.message}`;
                    }
                });

                // Add error event listeners
                boxEl.addEventListener('error', (error) => {
                    console.error('Box element error:', error);
                    debugDiv.textContent += `\nBox element error: ${error.detail.message || 'Unknown error'}`;
                });

                document.querySelector('a-scene').addEventListener('error', (error) => {
                    console.error('A-Scene error:', error);
                    debugDiv.textContent += `\nA-Scene error: ${error.detail.message || 'Unknown error'}`;
                });
            });
        </script>
    </body>
</html>
