<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>GeoAR.js Directions with Images</title>
    <script src='https://aframe.io/releases/0.9.2/aframe.min.js'></script>
    <script src="https://raw.githack.com/jeromeetienne/AR.js/master/aframe/build/aframe-ar.min.js"></script>
    <script src="https://raw.githack.com/donmccurdy/aframe-extras/master/dist/aframe-extras.loaders.min.js"></script>
    <script>
        THREEx.ArToolkitContext.baseURL = 'https://raw.githack.com/jeromeetienne/ar.js/master/three.js/';
    </script>
    <script>
        AFRAME.registerComponent('waypoints', {
            init: function () {
                const params = new URLSearchParams(window.location.search);
                const routeId = params.get('routeId');
                if (routeId) {
                    this.loadWaypoints(routeId);
                }
            },
            loadWaypoints: function (routeId) {
                fetch(`http://localhost:3000/get-waypoints/${routeId}`)
                    .then(response => response.json())
                    .then(waypoints => {
                        waypoints.forEach((waypoint) => {
                            const entity = document.createElement('a-image');
                            entity.setAttribute('src', './assets/arrow.jpeg');
                            entity.setAttribute('gps-entity-place', `longitude: ${waypoint.longitude}; latitude: ${waypoint.latitude};`);
                            entity.setAttribute('rotation', '-90 0 0');  // Rotate image to lie flat on the ground
                            entity.setAttribute('width', '3');  // Adjust size as needed
                            entity.setAttribute('height', '3');
                            this.el.sceneEl.appendChild(entity);
                        });
                    })
                    .catch(error => console.error('Error loading waypoints:', error));
            }
        });
    </script>
</head>

<body style='margin: 0; overflow: hidden;'>
    <a-scene
        vr-mode-ui="enabled: false"
        embedded
        arjs='sourceType: webcam; sourceWidth:1280; sourceHeight:960; displayWidth: 1280; displayHeight: 960; debugUIEnabled: false;'
        waypoints>
        
        <a-camera gps-camera rotation-reader></a-camera>
    </a-scene>
</body>
</html>
